<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - AetherCubix</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="styles/admin.css">
    <link rel="stylesheet" href="styles/admin-guard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="icon" href="https://cdn-icons-png.flaticon.com/128/613/613962.png" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Botón hamburguesa para menú lateral -->
    <button class="menu-toggle" id="menuToggle" aria-label="Abrir menú">
        <i class="fas fa-bars"></i>
    </button>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="admin-layout">
        <!-- Sidebar -->
        <nav class="admin-sidebar" id="adminSidebar">
            <div class="sidebar-header">
                <i class="fas fa-cube"></i>
                <span>AetherCubix Admin</span>
            </div>
            <ul class="sidebar-menu">
                <li><a href="index.html" class="active" onclick="mostrarSeccion('dashboard')"><i
                            class="fas fa-chart-bar"></i> Dashboard</a></li>
                <li><a href="#pedidos" onclick="mostrarSeccion('pedidos')"><i class="fas fa-shopping-cart"></i> Gestión
                        de Pedidos</a></li>
                <li><a href="gestion-productos.html"><i class="fas fa-box"></i> Gestión de Productos</a></li>
                <li><a href="power-bi.html"><i class="fas fa-chart-pie"></i> Power BI Analytics</a></li>
                <li><a href="ai-assistant.html"><i class="fas fa-robot"></i> Asistente IA</a></li>
                <li><a href="../index.html"><i class="fas fa-arrow-left"></i> Volver al sitio</a></li>
            </ul>
        </nav>

        <!-- Main content -->
        <main class="admin-main">
            <header class="admin-header">
                <h1 id="page-title">Dashboard Administrativo</h1>
                <div class="admin-user">
                    <i class="fas fa-user-circle"></i>
                    <span>Administrador</span>
                    <button class="btn-notification" id="notifications-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count" id="notification-count">0</span>
                    </button>
                </div>
            </header>

            <div class="admin-content">
                <!-- ===== SECCIÓN DASHBOARD ===== -->
                <div id="section-dashboard" class="admin-section active">
                    <!-- Stats Cards combinadas -->
                    <div class="stats-grid">
                        <!-- Stats originales del inventario -->
                        <div class="stat-card">
                            <i class="fas fa-box"></i>
                            <div class="stat-info">
                                <h3 id="total-products">0</h3>
                                <p>Total Productos</p>
                                <div class="stat-change positive" id="products-change">+0%</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <i class="fas fa-layer-group"></i>
                            <div class="stat-info">
                                <h3 id="total-categories">0</h3>
                                <p>Categorías</p>
                                <div class="stat-change neutral">3 tipos</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <i class="fas fa-chart-line"></i>
                            <div class="stat-info">
                                <h3 id="total-value">Q 0.00</h3>
                                <p>Valor Inventario</p>
                                <div class="stat-change positive" id="inventory-change">+0%</div>
                            </div>
                        </div>

                        <div class="stat-card alert">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div class="stat-info">
                                <h3 id="low-stock-products">0</h3>
                                <p>Stock Bajo</p>
                                <div class="stat-change negative">Revisar</div>
                            </div>
                        </div>
                        <!--en desarrollo -->
                        <!-- Nuevas stats de pedidos
                        <div class="stat-card">
                            <i class="fas fa-shopping-cart"></i>
                            <div class="stat-info">
                                <h3 id="pedidos-hoy">0</h3>
                                <p>Pedidos Hoy</p>
                                <div class="stat-change positive" id="pedidos-change">+0</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-dollar-sign"></i>
                            <div class="stat-info">
                                <h3 id="ventas-hoy">Q 0.00</h3>
                                <p>Ventas Hoy</p>
                                <div class="stat-change positive" id="ventas-change">+Q 0.00</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-users"></i>
                            <div class="stat-info">
                                <h3 id="total-usuarios">0</h3>
                                <p>Total Usuarios</p>
                                <div class="stat-change positive" id="usuarios-change">+0</div>
                            </div>
                        </div>
                        
                        <div class="stat-card warning">
                            <i class="fas fa-clock"></i>
                            <div class="stat-info">
                                <h3 id="pedidos-pendientes">0</h3>
                                <p>Pendientes</p>
                                <div class="stat-change neutral">Procesar</div>
                            </div>
                        </div> -->
                    </div>

                    <!-- Resumen Rápido -->
                    <div class="summary-section">
                        <h3><i class="fas fa-chart-line"></i> Resumen del Día</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-label">Ingresos Totales</div>
                                <div class="summary-value" id="ingresos-totales">Q 0.00</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Productos Vendidos</div>
                                <div class="summary-value" id="productos-vendidos">0</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Ticket Promedio</div>
                                <div class="summary-value" id="ticket-promedio">Q 0.00</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Conversión</div>
                                <div class="summary-value" id="tasa-conversion">0%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficas combinadas -->
                    <div class="charts-grid">
                        <!-- Gráfica de ventas con selector -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h4><i class="fas fa-chart-line"></i> Tendencia de Ventas</h4>
                                <select id="ventas-period" class="period-selector">
                                    <option value="7">Últimos 7 días</option>
                                    <option value="30">Últimos 30 días</option>
                                    <option value="90">Últimos 3 meses</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="ventasChart"></canvas>
                            </div>
                        </div>

                        <!-- Gráfica de estados de pedidos -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h4><i class="fas fa-chart-pie"></i> Estados de Pedidos</h4>
                            </div>
                            <div class="chart-container">
                                <canvas id="pedidosChart"></canvas>
                            </div>
                        </div>

                        <!-- Gráfica de productos más vendidos -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h4><i class="fas fa-chart-bar"></i> Productos Más Vendidos</h4>
                            </div>
                            <div class="chart-container">
                                <canvas id="productosChart"></canvas>
                            </div>
                        </div>

                        <!-- Gráfica de estado del stock -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h4><i class="fas fa-chart-bar"></i> Estado del Stock</h4>
                            </div>
                            <div class="chart-container">
                                <canvas id="stockChart"></canvas>
                            </div>
                        </div>

                        <!-- Gráfica de valor por categoría -->
                        <div class="chart-card large">
                            <div class="chart-header">
                                <h4><i class="fas fa-chart-area"></i> Valor por Categoría</h4>
                            </div>
                            <div class="chart-container">
                                <canvas id="valueChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Pedidos Recientes -->
                    <div class="recent-orders">
                        <div class="section-header">
                            <h3><i class="fas fa-clock"></i> Pedidos Recientes</h3>
                            <a href="#pedidos" onclick="mostrarSeccion('pedidos')" class="btn btn-outline">Ver Todos</a>
                        </div>
                        <div class="orders-table-container">
                            <table class="orders-table" id="recent-orders-table">
                                <thead>
                                    <tr>
                                        <th>Pedido</th>
                                        <th>Cliente</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                        <th>Fecha</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-orders-body">
                                    <!-- Se cargan dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Quick Actions mejoradas -->
                    <div class="quick-actions">
                        <h3>Acciones Rápidas</h3>
                        <div class="action-buttons">
                            <a href="gestion-productos.html" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Nuevo Producto
                            </a>
                            <button class="btn btn-secondary" onclick="loadDashboardStats()">
                                <i class="fas fa-sync"></i> Actualizar
                            </button>
                            <button class="btn btn-info" onclick="exportStats()">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                            <button class="btn btn-warning" onclick="mostrarAlertasStock()">
                                <i class="fas fa-bell"></i> Alertas Stock
                            </button>
                        </div>
                    </div>
                </div>


                <!-- Panel de Insights Inteligentes -->
                <div class="insights-panel">
                    <div class="insights-header">
                        <h3>Insights Inteligentes</h3>
                        <button class="btn btn-outline" onclick="refreshInsights()">
                            <i class="fas fa-sync"></i> Actualizar Insights
                        </button>
                    </div>

                    <div class="insights-container">
                        <div class="insights-tabs">
                            <button class="insight-tab active" data-tab="ventas">
                                <i class="fas fa-chart-line"></i> Ventas
                            </button>
                            <button class="insight-tab" data-tab="productos">
                                <i class="fas fa-cube"></i> Productos
                            </button>
                            <button class="insight-tab" data-tab="stock">
                                <i class="fas fa-warehouse"></i> Inventario
                            </button>
                            <button class="insight-tab" data-tab="predicciones">
                                <i class="fas fa-chart-pie"></i> Predicciones
                            </button>
                        </div>

                        <div class="insights-content">
                            <div id="insights-ventas" class="insight-tab-content active">
                                <div id="ventas-insights" class="insights-cards">
                                    <!-- Aquí se generan tarjetas de ventas -->
                                </div>
                            </div>

                            <div id="insights-productos" class="insight-tab-content">
                                <div id="productos-insights" class="insights-cards">
                                    <!-- Aquí se generan tarjetas de productos -->
                                </div>
                            </div>

                            <div id="insights-stock" class="insight-tab-content">
                                <div id="stock-insights" class="insights-cards">
                                    <!-- Aquí se generan tarjetas de stock -->
                                </div>
                            </div>

                            <div id="insights-predicciones" class="insight-tab-content">
                                <div id="predicciones-insights" class="insights-cards">
                                    <!-- Aquí se generan tarjetas de predicciones -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ====================================================== -->
                <!-- ====================================================== -->
                <!-- ===== SECCIÓN GESTIÓN DE PEDIDOS ===== -->
                <div id="section-pedidos" class="admin-section">
                    <div class="section-header">
                        <h2><i class="fas fa-shopping-cart"></i> Gestión de Pedidos</h2>
                        <div class="section-filters">
                            <select id="filtro-estado" class="filter-select">
                                <option value="">Todos los estados</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="confirmado">Confirmado</option>
                                <option value="enviado">Enviado</option>
                                <option value="entregado">Entregado</option>
                                <option value="cancelado">Cancelado</option>
                            </select>
                            <input type="date" id="filtro-fecha" class="filter-input">
                            <input type="text" id="buscar-pedido" placeholder="Buscar pedido o cliente..."
                                class="search-input">
                            <button class="btn btn-secondary" onclick="limpiarFiltrosPedidos()">
                                <i class="fas fa-eraser"></i> Limpiar
                            </button>
                        </div>
                    </div>

                    <!-- Estadísticas de Pedidos -->
                    <div class="pedidos-stats">
                        <div class="stat-card small">
                            <div class="stat-info">
                                <h4 id="total-pedidos-filtrados">0</h4>
                                <p>Total Pedidos</p>
                            </div>
                        </div>
                        <div class="stat-card small">
                            <div class="stat-info">
                                <h4 id="total-ventas-filtradas">Q 0.00</h4>
                                <p>Total Ventas</p>
                            </div>
                        </div>
                        <div class="stat-card small">
                            <div class="stat-info">
                                <h4 id="promedio-pedido">Q 0.00</h4>
                                <p>Promedio/Pedido</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de Pedidos -->
                    <div class="pedidos-table-container">
                        <table class="admin-table" id="pedidos-table">
                            <thead>
                                <tr>
                                    <th>Pedido</th>
                                    <th>Cliente</th>
                                    <th>Productos</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="pedidos-table-body">
                                <!-- Se cargan dinámicamente -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Paginación -->
                    <div class="pagination" id="pedidos-pagination">
                        <button class="btn-pagination" id="prev-pedidos" onclick="cambiarPaginaPedidos(-1)">
                            <i class="fas fa-chevron-left"></i> Anterior
                        </button>
                        <span class="pagination-info">
                            Página <span id="pagina-actual-pedidos">1</span> de <span
                                id="total-paginas-pedidos">1</span>
                        </span>
                        <button class="btn-pagination" id="next-pedidos" onclick="cambiarPaginaPedidos(1)">
                            Siguiente <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modales existentes -->
    <div id="pedido-details-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="pedido-modal-title">Detalles del Pedido</h3>
                <button class="modal-close" onclick="cerrarModalPedido()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="pedido-modal-body">
                <!-- Contenido dinámico -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalPedido()">
                    Cerrar
                </button>
                <button class="btn btn-primary" id="imprimir-pedido-btn" onclick="imprimirPedidoAdmin()">
                    <i class="fas fa-print"></i> Imprimir
                </button>
            </div>
        </div>
    </div>

    <div id="estado-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Cambiar Estado del Pedido</h3>
                <button class="modal-close" onclick="cerrarModalEstado()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Pedido: <strong id="pedido-numero-estado"></strong></p>
                <p>Cliente: <strong id="cliente-nombre-estado"></strong></p>
                <div class="form-group">
                    <label for="nuevo-estado">Nuevo Estado:</label>
                    <select id="nuevo-estado" class="form-control">
                        <option value="pendiente">Pendiente</option>
                        <option value="confirmado">Confirmado</option>
                        <option value="enviado">Enviado</option>
                        <option value="entregado">Entregado</option>
                        <option value="cancelado">Cancelado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="notas-estado">Notas (opcional):</label>
                    <textarea id="notas-estado" class="form-control" rows="3"
                        placeholder="Agregar notas sobre el cambio de estado..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalEstado()">
                    Cancelar
                </button>
                <button class="btn btn-primary" onclick="confirmarCambioEstado()">
                    <i class="fas fa-save"></i> Guardar Cambio
                </button>
            </div>
        </div>
    </div>

    <!-- scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script type="module" src="scripts/admin-guard.js"></script>
    <script type="module" src="scripts/admin.js"></script>
    <script type="module" src="scripts/insights.js"></script>
    <script>
        const menuToggle = document.getElementById('menuToggle');
        const adminSidebar = document.getElementById('adminSidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const adminHeader = document.querySelector('.admin-header');

        function openSidebar() {
            adminSidebar.classList.add('open');
            sidebarOverlay.classList.add('active');
            if (window.innerWidth < 900 && adminHeader) {
                adminHeader.classList.add('hide-on-menu');
            }
        }
        function closeSidebar() {
            adminSidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
            if (adminHeader) {
                adminHeader.classList.remove('hide-on-menu');
            }
        }
        menuToggle.addEventListener('click', function () {
            if (adminSidebar.classList.contains('open')) {
                closeSidebar();
            } else {
                openSidebar();
            }
        });
        sidebarOverlay.addEventListener('click', closeSidebar);

        document.querySelectorAll('.admin-sidebar a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 900) closeSidebar();
            });
        });
    </script>
</body>

</html>